<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vue3 + Ant Design Vue 数据表格</title>
    <script src="https://unpkg.com/vue@3.4.27/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/dayjs/dayjs.min.js"></script>
    <script src="https://unpkg.com/dayjs/plugin/customParseFormat.js"></script>
    <script src="https://unpkg.com/dayjs/plugin/weekday.js"></script>
    <script src="https://unpkg.com/dayjs/plugin/localeData.js"></script>
    <script src="https://unpkg.com/dayjs/plugin/weekOfYear.js"></script>
    <script src="https://unpkg.com/dayjs/plugin/weekYear.js"></script>
    <script src="https://unpkg.com/dayjs/plugin/advancedFormat.js"></script>
    <script src="https://unpkg.com/dayjs/plugin/quarterOfYear.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@ant-design/icons-vue@7.0.1/dist/antd-icons.min.js"></script>
    <link
      type="text/css"
      href="https://unpkg.com/ant-design-vue@4.2.3/dist/reset.css"
      media="screen"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/ant-design-vue@4.2.3/dist/antd.min.js"></script>
    <style>
      .page-container {
        padding: 24px;
        max-width: 1200px;
        margin: 0 auto;
      }
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
      }
      .expanded-content {
        padding: 16px;
        background-color: #fafafa;
        border-radius: 4px;
        border: 1px solid #f0f0f0;
      }
      .expanded-section {
        margin-bottom: 16px;
      }
      .expanded-section:last-child {
        margin-bottom: 0;
      }
      .section-title {
        font-weight: 600;
        margin-bottom: 8px;
        color: #1677ff;
      }
      .item-row {
        display: flex;
        margin-bottom: 4px;
      }
      .item-label {
        width: 80px;
        color: #666;
        margin-right: 8px;
      }
      .tag-list {
        margin-top: 8px;
      }
    </style>
  </head>

  <body>
    <div id="app">
      <a-config-provider :locale="locale">
        <div class="page-container">
          <div class="header">
            <h2>项目管理系统</h2>
            <a-space>
              <a-button type="primary" @click="handleAdd"> 新建项目 </a-button>
              <a-button @click="handleRefresh"> 刷新 </a-button>
            </a-space>
          </div>

          <a-card>
            <a-form layout="inline" :model="searchForm" @finish="handleSearch">
              <a-form-item name="name" label="项目名称">
                <a-input
                  v-model:value="searchForm.name"
                  placeholder="请输入项目名称"
                />
              </a-form-item>
              <a-form-item name="status" label="状态">
                <a-select
                  v-model:value="searchForm.status"
                  placeholder="请选择状态"
                  style="width: 150px"
                  allowClear
                >
                  <a-select-option value="active">进行中</a-select-option>
                  <a-select-option value="pending">待启动</a-select-option>
                  <a-select-option value="completed">已完成</a-select-option>
                </a-select>
              </a-form-item>
              <a-form-item>
                <a-button type="primary" html-type="submit"> 搜索 </a-button>
                <a-button style="margin-left: 8px" @click="resetSearch">
                  重置
                </a-button>
              </a-form-item>
            </a-form>

            <a-divider style="margin: 16px 0" />

            <a-table
              :columns="columns"
              :data-source="tableData"
              :loading="loading"
              :pagination="pagination"
              @change="handleTableChange"
              rowKey="id"
            >
              <!-- 自定义列内容 -->
              <template #bodyCell="{ column, record }">
                <!-- 状态列 -->
                <template v-if="column.dataIndex === 'status'">
                  <a-tag :color="getStatusColor(record.status)">
                    {{ getStatusText(record.status) }}
                  </a-tag>
                </template>

                <!-- 操作列 -->
                <template v-if="column.dataIndex === 'action'">
                  <a-space>
                    <a-button type="link" @click="toggleExpand(record)">
                      {{ expandedKeys.includes(record.id) ? '收起' : '详情' }}
                    </a-button>
                    <a-button type="link" @click="handleEdit(record)">
                      编辑
                    </a-button>
                    <a-popconfirm
                      title="确定要删除这个项目吗?"
                      ok-text="确定"
                      cancel-text="取消"
                      @confirm="handleDelete(record)"
                    >
                      <a-button type="link" danger> 删除 </a-button>
                    </a-popconfirm>
                  </a-space>
                </template>
              </template>

              <!-- 展开内容 -->
              <template #expandedRowRender="{ record }">
                <div class="expanded-content">
                  <div class="expanded-section">
                    <div class="section-title">基本信息</div>
                    <div class="item-row">
                      <span class="item-label">创建时间:</span>
                      <span>{{ record.createTime }}</span>
                    </div>
                    <div class="item-row">
                      <span class="item-label">负责人:</span>
                      <span>{{ record.owner }}</span>
                    </div>
                    <div class="item-row">
                      <span class="item-label">联系方式:</span>
                      <span>{{ record.contact }}</span>
                    </div>
                  </div>

                  <div class="expanded-section">
                    <div class="section-title">项目描述</div>
                    <div>{{ record.description }}</div>
                  </div>

                  <div class="expanded-section">
                    <div class="section-title">项目标签</div>
                    <div class="tag-list">
                      <a-tag v-for="tag in record.tags" :key="tag" color="blue"
                        >{{ tag }}</a-tag
                      >
                    </div>
                  </div>

                  <div class="expanded-section">
                    <div class="section-title">进度统计</div>
                    <a-progress :percent="record.progress" status="active" />
                  </div>
                </div>
              </template>
            </a-table>
          </a-card>
        </div>
      </a-config-provider>
    </div>

    <script>
      const { createApp, ref, reactive, computed, onMounted } = Vue;

      const app = createApp({
        setup() {
          // 加载状态
          const loading = ref(false);

          // 展开的行
          const expandedKeys = ref([]);

          // 搜索表单
          const searchForm = reactive({
            name: "",
            status: undefined,
          });

          // 分页配置
          const pagination = reactive({
            current: 1,
            pageSize: 10,
            total: 0,
            showSizeChanger: true,
            showTotal: (total) => `共 ${total} 条`,
          });

          // 表格列配置
          const columns = [
            {
              title: "项目名称",
              dataIndex: "name",
              sorter: true,
              ellipsis: true,
            },
            {
              title: "项目类型",
              dataIndex: "type",
              width: 120,
            },
            {
              title: "开始日期",
              dataIndex: "startDate",
              width: 120,
              sorter: true,
            },
            {
              title: "结束日期",
              dataIndex: "endDate",
              width: 120,
            },
            {
              title: "状态",
              dataIndex: "status",
              width: 100,
              filters: [
                { text: "进行中", value: "active" },
                { text: "待启动", value: "pending" },
                { text: "已完成", value: "completed" },
              ],
            },
            {
              title: "操作",
              dataIndex: "action",
              width: 200,
              fixed: "right",
            },
          ];

          // 模拟数据
          const mockData = [
            {
              id: 1,
              name: "企业官网重构项目",
              type: "网站开发",
              startDate: "2023-01-15",
              endDate: "2023-04-30",
              status: "active",
              createTime: "2023-01-10 14:30:45",
              owner: "张经理",
              contact: "13812345678",
              description:
                "对公司官网进行全面改版升级，提升用户体验和品牌形象展示效果。主要包括首页设计、产品展示、新闻中心、关于我们等版块的重新设计和开发。",
              tags: ["前端开发", "UI设计", "响应式"],
              progress: 65,
            },
            {
              id: 2,
              name: "客户管理系统升级",
              type: "系统开发",
              startDate: "2023-02-20",
              endDate: "2023-05-15",
              status: "pending",
              createTime: "2023-02-10 09:15:22",
              owner: "李工程师",
              contact: "13987654321",
              description:
                "对现有的客户管理系统进行功能升级和性能优化，添加数据分析模块和自动化营销功能，提升系统响应速度和用户体验。",
              tags: ["后端开发", "数据库", "微服务"],
              progress: 25,
            },
            {
              id: 3,
              name: "移动端APP开发",
              type: "应用开发",
              startDate: "2022-11-10",
              endDate: "2023-03-20",
              status: "completed",
              createTime: "2022-10-25 16:42:18",
              owner: "王产品",
              contact: "13598765432",
              description:
                "开发一款面向企业客户的移动应用，实现产品查询、订单管理、账户信息查看等功能，支持iOS和Android双平台。",
              tags: ["移动开发", "React Native", "API集成"],
              progress: 100,
            },
            {
              id: 4,
              name: "数据分析平台",
              type: "数据处理",
              startDate: "2023-03-01",
              endDate: "2023-06-30",
              status: "active",
              createTime: "2023-02-15 11:20:35",
              owner: "刘数据",
              contact: "13765432198",
              description:
                "构建企业级数据分析平台，整合各业务系统数据，提供数据清洗、分析和可视化功能，支持业务决策和营销策略制定。",
              tags: ["大数据", "可视化", "BI工具"],
              progress: 45,
            },
          ];

          // 表格数据
          const tableData = ref([...mockData]);

          // 获取状态文本
          const getStatusText = (status) => {
            const statusMap = {
              active: "进行中",
              pending: "待启动",
              completed: "已完成",
            };
            return statusMap[status] || status;
          };

          // 获取状态颜色
          const getStatusColor = (status) => {
            const colorMap = {
              active: "green",
              pending: "orange",
              completed: "blue",
            };
            return colorMap[status] || "default";
          };

          // 切换展开状态
          const toggleExpand = (record) => {
            const id = record.id;
            const index = expandedKeys.value.indexOf(id);
            if (index !== -1) {
              expandedKeys.value.splice(index, 1);
            } else {
              expandedKeys.value.push(id);
            }
          };

          // 处理表格变化
          const handleTableChange = (pag, filters, sorter) => {
            loading.value = true;

            // 更新分页信息
            pagination.current = pag.current;
            pagination.pageSize = pag.pageSize;

            // 模拟API调用
            setTimeout(() => {
              let result = [...mockData];

              // 处理筛选
              if (filters.status && filters.status.length > 0) {
                result = result.filter((item) =>
                  filters.status.includes(item.status)
                );
              }

              // 处理排序
              if (sorter.field) {
                const order = sorter.order === "ascend" ? 1 : -1;
                result = result.sort((a, b) => {
                  return a[sorter.field] > b[sorter.field] ? order : -order;
                });
              }

              tableData.value = result;
              pagination.total = result.length;
              loading.value = false;
            }, 500);
          };

          // 处理搜索
          const handleSearch = () => {
            loading.value = true;
            pagination.current = 1;

            // 模拟API调用
            setTimeout(() => {
              let result = [...mockData];

              if (searchForm.name) {
                result = result.filter((item) =>
                  item.name
                    .toLowerCase()
                    .includes(searchForm.name.toLowerCase())
                );
              }

              if (searchForm.status) {
                result = result.filter(
                  (item) => item.status === searchForm.status
                );
              }

              tableData.value = result;
              pagination.total = result.length;
              loading.value = false;
            }, 500);
          };

          // 重置搜索
          const resetSearch = () => {
            searchForm.name = "";
            searchForm.status = undefined;
            handleSearch();
          };

          // 添加项目
          const handleAdd = () => {
            console.log("添加新项目");
          };

          // 刷新
          const handleRefresh = () => {
            loading.value = true;

            // 模拟API调用
            setTimeout(() => {
              tableData.value = [...mockData];
              pagination.total = mockData.length;
              loading.value = false;
            }, 500);
          };

          // 编辑项目
          const handleEdit = (record) => {
            console.log("编辑项目:", record);
          };

          // 删除项目
          const handleDelete = (record) => {
            console.log("删除项目:", record);
            tableData.value = tableData.value.filter(
              (item) => item.id !== record.id
            );
          };

          // 组件挂载
          onMounted(() => {
            pagination.total = mockData.length;
          });

          // 中文本地化
          const locale = {
            locale: "zh_CN",
          };

          return {
            columns,
            tableData,
            loading,
            pagination,
            expandedKeys,
            searchForm,
            locale,
            getStatusText,
            getStatusColor,
            toggleExpand,
            handleTableChange,
            handleSearch,
            resetSearch,
            handleAdd,
            handleRefresh,
            handleEdit,
            handleDelete,
          };
        },
      });

      app.use(antd).mount("#app");
    </script>
  </body>
</html>
